<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>odt_create_users.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>odt_create_users.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>Author: <a href="http://donaldmerand.com">Donald L. Merand</a> for
<a href="http://www.explo.org">Explo</a></p>

<p>I wrote this program to create LDAP (specifically Open Directory on OS X 10.7
users, and optionally assign them to groups, based on a simple export of user
names from eg. yer database.</p>

<p>It takes a tab-separated file in the form: <code>FirstName TAB LastName</code> and
creates an OD user for each row.</p>

<p>You can pass an OD group you&rsquo;d like your users to be in with the <code>-g
GROUPNAME</code> command-line option. </p>

<p>The program will output a file (<code>server_user_list.txt</code> by default) which is a
list of all usernames and passwords that have been added to the OD.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>We use optparse to do command line options</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s1">&#39;optparse&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-Initialize_variables'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Initialize_variables">&#182;</a>
        </div>
        <h2>Initialize variables</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>I&rsquo;m assuming you&rsquo;ll be using a local OD host
(ie you&rsquo;re running this utility on your OD server)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">od_host</span> <span class="o">=</span> <span class="s2">&quot;/LDAPv3/127.0.0.1/&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Diradmin is the default user on OS X Server</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">od_user</span> <span class="o">=</span> <span class="s2">&quot;diradmin&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>Password is intentionally blank. You know, for security.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">od_pass</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>Optional OD group to which to add all users</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">od_group</span> <span class="o">=</span> <span class="o">[]</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>This is the file full of users you pass in.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">user_input_file</span> <span class="o">=</span> <span class="s2">&quot;portico_user_list.txt&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>This is the name of the list of usernames and passwords that gets generated.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">user_output_file</span> <span class="o">=</span> <span class="s2">&quot;server_user_list.txt&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-Parse_Command_Line_Options'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Parse_Command_Line_Options">&#182;</a>
        </div>
        <h2>Parse Command Line Options</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Simple function to show help for the command-line interface</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">def</span> <span class="nf">show_help</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">opts</span>
  <span class="nb">exit</span> <span class="mi">0</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Optparse is totally rad for reading command line options.  Hopefully it&rsquo;ll be
relatively obvious what&rsquo;s going on here.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">optparse</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="s2">&quot;Usage: create_users.rb |options|&quot;</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="s1">&#39;show this help&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="n">show_help</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--pass PASSWORD&#39;</span><span class="p">,</span> <span class="s1">&#39;(required) specify a dscl/OD pass&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">pass</span><span class="o">|</span> 
    <span class="n">od_pass</span> <span class="o">=</span> <span class="n">pass</span>
  <span class="k">end</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-u&#39;</span><span class="p">,</span> <span class="s1">&#39;--user USERNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;specify a dscl/OD user&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
    <span class="n">od_user</span> <span class="o">=</span> <span class="n">user</span>
  <span class="k">end</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="s1">&#39;--input_file FILE&#39;</span><span class="p">,</span> <span class="s1">&#39;specify a file from which to import&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">user_input_file</span> <span class="o">=</span> <span class="n">file</span>
  <span class="k">end</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;--output_file FILE&#39;</span><span class="p">,</span> <span class="s1">&#39;output results to file&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">user_output_file</span> <span class="o">=</span> <span class="n">file</span>
  <span class="k">end</span>
  <span class="n">g_desc</span> <span class="o">=</span> <span class="s1">&#39;set created OD user group. use -g group1 -g group2 if you want.&#39;</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-g&#39;</span><span class="p">,</span> <span class="s1">&#39;--group GROUPNAME&#39;</span><span class="p">,</span> <span class="n">g_desc</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">group</span><span class="o">|</span>
    <span class="n">od_group</span><span class="o">.</span><span class="n">push</span> <span class="n">group</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>Do the actual parsing of options, now that we&rsquo;ve set it up.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">optparse</span><span class="o">.</span><span class="n">parse!</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Validate that a password was sent, exit if not.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">show_help</span><span class="p">(</span><span class="n">optparse</span><span class="p">)</span> <span class="k">if</span> <span class="n">od_pass</span><span class="o">.</span><span class="n">empty?</span></pre></div>
      </td>
    </tr>
    <tr id='section-Okay_We&amp;rsquo;re_Ready'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-Okay_We&amp;rsquo;re_Ready">&#182;</a>
        </div>
        <h2>Okay We&rsquo;re Ready</h2>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>Attempt to open the input users file for reading</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">od_user_list</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">user_input_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span></pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>Attempt to open/create the output users file for appending</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">output_users</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">user_output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Simple function to create a random password,
which I got <a href="http://stackoverflow.com/a/3572953">here</a></p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">def</span> <span class="nf">rand_pass</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">36</span><span class="o">**</span><span class="n">length</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>Set up the basic <code>dscl</code> command we&rsquo;ll be using to do all <code>dscl</code> stuff
If you don&rsquo;t know about dscl, <code>man dscl</code> will be helpful ;)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">dscl_command</span> <span class="o">=</span> <span class="s2">&quot;dscl -u </span><span class="si">#{</span><span class="n">od_user</span><span class="si">}</span><span class="s2"> -P </span><span class="si">#{</span><span class="n">od_pass</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">od_host</span><span class="si">}</span><span class="s2">&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>Get the most recent UNIQUE ID from OD. We only have to do this once
via DSCL, then just increment it below, since that&rsquo;s all that OD
would do.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">unique_id</span> <span class="o">=</span> <span class="sb">`dscl </span><span class="si">#{</span><span class="n">od_host</span><span class="si">}</span><span class="sb"> list Users UniqueID | awk &#39;{print $2}&#39; | sort -ug | tail -1`</span><span class="o">.</span><span class="n">to_i</span></pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>For each user in the input file&hellip;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">od_user_list</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>Get rid of the new line and split into fields based on tab</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">row</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>Get variables based on field position
expects: First Name TAB Last Name</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">first_name</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
  <span class="n">last_name</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>User name is first and last name, lower case, without any fance characters
such as &ndash; or &lsquo;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">first_name</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">%r/(\s|\&#39;|-)/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span><span class="si">}#{</span><span class="n">last_name</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">%r/(\s|\&#39;|-)/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span><span class="si">}</span><span class="s2">&quot;</span></pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>If there&rsquo;s anything else in the row, pass it along to the output as
tab-separated</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">whatever_else</span> <span class="o">=</span> <span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">row</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span></pre></div>
      </td>
    </tr>
    <tr id='section-27'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-27">&#182;</a>
        </div>
        <p>Create a random password</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">pass</span> <span class="o">=</span> <span class="n">rand_pass</span></pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>Increment the unique_id from above once per row</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">unique_id</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>Since system calls exit 0 on success, I&rsquo;m going to add all the exit
statuses and make a fuss if they are greater than zero</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">num_errors</span> <span class="o">=</span> <span class="mi">0</span></pre></div>
      </td>
    </tr>
    <tr id='section-30'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-30">&#182;</a>
        </div>
        <p>Attempt user creation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vg">$stdout</span><span class="o">.</span><span class="n">printf</span> <span class="s2">&quot;Attempting to create %s %s... &quot;</span><span class="p">,</span> <span class="n">od_group</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">user_name</span>
  <span class="nb">system</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">dscl_command</span><span class="si">}</span><span class="s2"> create Users/</span><span class="si">#{</span><span class="n">user_name</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">num_errors</span> <span class="o">+=</span> <span class="vg">$?</span><span class="o">.</span><span class="n">exitstatus</span>
  <span class="nb">system</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">dscl_command</span><span class="si">}</span><span class="s2"> create Users/</span><span class="si">#{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> UniqueID </span><span class="si">#{</span><span class="n">unique_id</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">num_errors</span> <span class="o">+=</span> <span class="vg">$?</span><span class="o">.</span><span class="n">exitstatus</span>
  <span class="nb">system</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">dscl_command</span><span class="si">}</span><span class="s2"> create Users/</span><span class="si">#{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> RealName &#39;</span><span class="si">#{</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">last_name</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">%r/(\s|\&#39;|-)/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
  <span class="n">num_errors</span> <span class="o">+=</span> <span class="vg">$?</span><span class="o">.</span><span class="n">exitstatus</span>
  <span class="nb">system</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">dscl_command</span><span class="si">}</span><span class="s2"> create Users/</span><span class="si">#{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> PrimaryGroupID 1025&quot;</span>
  <span class="n">num_errors</span> <span class="o">+=</span> <span class="vg">$?</span><span class="o">.</span><span class="n">exitstatus</span>
  <span class="nb">system</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">dscl_command</span><span class="si">}</span><span class="s2"> passwd Users/</span><span class="si">#{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">pass</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">num_errors</span> <span class="o">+=</span> <span class="vg">$?</span><span class="o">.</span><span class="n">exitstatus</span></pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p>Add users to group if applicable</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">unless</span> <span class="n">od_group</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">od_group</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">group</span><span class="o">|</span>
      <span class="nb">system</span> <span class="s2">&quot;dseditgroup -u </span><span class="si">#{</span><span class="n">od_user</span><span class="si">}</span><span class="s2"> -P </span><span class="si">#{</span><span class="n">od_pass</span><span class="si">}</span><span class="s2"> -o edit -t user -a </span><span class="si">#{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">group</span><span class="o">.</span><span class="n">downcase</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="n">num_errors</span> <span class="o">+=</span> <span class="vg">$?</span><span class="o">.</span><span class="n">exitstatus</span>
    <span class="k">end</span>
  <span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-32'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-32">&#182;</a>
        </div>
        <p>If there were no errors with the pile of shell scripts I just ran&hellip;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span> <span class="n">num_errors</span> <span class="o">==</span> <span class="mi">0</span></pre></div>
      </td>
    </tr>
    <tr id='section-33'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-33">&#182;</a>
        </div>
        <p>Append username and password (and anything else passed in) to output file</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="n">output_users</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">user_name</span><span class="si">}</span><span class="se">\t</span><span class="si">#{</span><span class="n">pass</span><span class="si">}</span><span class="se">\t</span><span class="si">#{</span><span class="n">first_name</span><span class="si">}</span><span class="se">\t</span><span class="si">#{</span><span class="n">last_name</span><span class="si">}</span><span class="se">\t</span><span class="si">#{</span><span class="n">whatever_else</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="vg">$stdout</span><span class="o">.</span><span class="n">print</span> <span class="s2">&quot;Success!</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="c1"># ...continuing the line we printed above</span></pre></div>
      </td>
    </tr>
    <tr id='section-34'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-34">&#182;</a>
        </div>
        <p>Otherwise be a good UNIX citizen and print the results to STDERR</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">else</span>
    <span class="vg">$stderr</span><span class="o">.</span><span class="n">printf</span> <span class="s2">&quot;User creation error for %s :(</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">user_name</span>
  <span class="k">end</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-35'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-35">&#182;</a>
        </div>
        <p>Close our file references</p>

      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">od_user_list</span><span class="o">.</span><span class="n">close</span>
<span class="n">output_users</span><span class="o">.</span><span class="n">close</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
